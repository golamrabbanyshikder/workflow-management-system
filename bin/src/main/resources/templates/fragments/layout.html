<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title != null ? title + ' - Workflow Management System' : 'Workflow Management System'}">Workflow Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
    
    <!-- Page-specific CSS -->
    <th:block th:fragment="css"></th:block>
</head>
<body>
    <!-- Include Header -->
    <div th:replace="~{fragments/header :: header}"></div>
    
    <!-- Include Left Sidebar -->
    <div th:replace="~{fragments/left-sidebar :: leftSidebar}"></div>
    
    <!-- Main Content Area -->
    <main class="main-content" th:fragment="content">
        <!-- Page content will be inserted here -->
        <div th:replace="~{::content}"></div>
    </main>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script th:src="@{/js/app.js}"></script>
    
    <!-- Page-specific JavaScript -->
    <th:block th:fragment="js"></th:block>
    
    <!-- Layout JavaScript -->
    <script>
        // Sidebar functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            // Mobile sidebar toggle
            if (mobileSidebarToggle) {
                mobileSidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                    sidebarOverlay.classList.toggle('show');
                });
            }
            
            // Sidebar overlay click to close
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('show');
                    sidebarOverlay.classList.remove('show');
                });
            }
            
            // Desktop sidebar toggle (if needed)
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                });
            }
            
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Handle active menu highlighting
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.sidebar-nav .nav-link');
            
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
            
            // Quick actions toggle
            const quickActionsToggle = document.getElementById('quickActionsToggle');
            const rightPanel = document.getElementById('rightPanel');
            const closePanel = document.getElementById('closePanel');
            const rightPanelToggle = document.getElementById('rightPanelToggle');
            
            if (quickActionsToggle && rightPanel) {
                quickActionsToggle.addEventListener('click', function() {
                    rightPanel.classList.toggle('show');
                });
            }
            
            if (closePanel && rightPanel) {
                closePanel.addEventListener('click', function() {
                    rightPanel.classList.remove('show');
                });
            }
            
            if (rightPanelToggle && rightPanel) {
                rightPanelToggle.addEventListener('click', function() {
                    rightPanel.classList.toggle('show');
                });
            }
            
            // Search functionality
            const searchInput = document.querySelector('.search-input');
            const searchBtn = document.querySelector('.search-btn');
            
            if (searchInput && searchBtn) {
                searchBtn.addEventListener('click', function() {
                    const searchTerm = searchInput.value.trim();
                    if (searchTerm) {
                        // Implement search functionality
                        console.log('Searching for:', searchTerm);
                        // You can redirect to a search page or implement AJAX search
                    }
                });
                
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchBtn.click();
                    }
                });
            }
            
            // Notification badge management
            const notificationBtn = document.querySelector('.notification-btn');
            if (notificationBtn) {
                notificationBtn.addEventListener('click', function() {
                    // Remove notification badge when clicked
                    const badge = this.querySelector('.notification-badge');
                    if (badge) {
                        badge.style.display = 'none';
                    }
                });
            }
            
            // Message badge management
            const messageBtn = document.querySelector('.nav-btn .fa-envelope')?.parentElement;
            if (messageBtn) {
                messageBtn.addEventListener('click', function() {
                    // Remove message badge when clicked
                    const badge = this.querySelector('.message-badge');
                    if (badge) {
                        badge.style.display = 'none';
                    }
                });
            }
        });
        
        // Utility function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 80px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Utility function to confirm actions
        function confirmAction(message, callback) {
            if (confirm(message)) {
                callback();
            }
        }
        
        // Utility function to handle AJAX requests
        function ajaxRequest(url, method = 'GET', data = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            };
            
            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }
            
            return fetch(url, options)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('An error occurred. Please try again.', 'danger');
                    throw error;
                });
        }
    </script>
</body>
</html>